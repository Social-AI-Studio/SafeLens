# ===== Database =====
DATABASE_URL=postgresql+psycopg://user:password@localhost:5432/safelens_web_db  # change user & password

# ===== LLM Provider Routing =====
# Note: Backend routing is enforced per model in server.py:
# - SafeLens/llama-3-8b → HTTP backend at ANALYSIS_LLM_HTTP_URL
# - All other models (e.g., google/gemini-2.0-flash-001) → OpenRouter via OPENROUTER_API_KEY
# ANALYSIS_LLM_BACKEND remains as a default for other utilities/fallbacks.
ANALYSIS_LLM_BACKEND=http                       # openrouter|http|local (default: http)
ANALYSIS_LLM_MODEL=SafeLens/llama-3-8b          # Default model; per-video selection overrides
OPENROUTER_API_KEY=                             # Required for non‑SafeLens models
ANALYSIS_LLM_HTTP_URL=http://localhost:8192/v1  # Required for SafeLens/llama-3-8b over HTTP
ANALYSIS_LLM_HTTP_HEADERS={}                    # Optional JSON headers for HTTP provider
ANALYSIS_LLM_TIMEOUT_SEC=30                     # Default LLM timeout (seconds)

# ===== Vision Captioning (Qwen 2.5‑VL via vLLM) =====
QWEN_VLLM_BASE_URL=http://localhost:8193/v1
QWEN_VLLM_MODEL=Qwen/Qwen2.5-VL-7B-Instruct
QWEN_VLLM_API_KEY=
QWEN_VLLM_TIMEOUT_SEC=20
QWEN_VLLM_TEMPERATURE=0.1
QWEN_VLLM_MAX_TOKENS=1024
QWEN_VLLM_CAPTION_PROMPT='Describe every visible element in this frame with maximum detail and objectivity. Include all people/objects/text/environment with precise appearance, position, color, and composition. Avoid guesses; only state what is literally visible.'

# ===== Segmentation & Analysis =====
SEGMENTATION_AUTO=true
SEG_MIN_LEN_SEC=5.0
SEG_MAX_LEN_SEC=16.0
SEG_SCENE_THRESHOLD=0.85
SEG_SAMPLE_INTERVAL_SEC=2.0
SEG_BATCH_SIZE=8
SEG_VIT_MODEL=google/vit-base-patch16-224
SEG_DEVICE=auto
SEG_NLTK_MIN_SENTENCE_CHARS=20
SEG_MAX_ITERATIONS=7
SEG_MERGE_THRESHOLD_FACTOR=1.2
SEG_NON_OVERLAP_TOLERANCE_SEC=0.20
SEG_MAX_LEN_SOFT_FACTOR=1.15
SEG_TRIM_TO_TRANSCRIPT_BOUNDARIES=true
SEG_CONTEXT_EVIDENCE_PAD_SEC=1.5
SEG_DROP_TINY_AFTER_TRIM_FACTOR=0.5

# Frame sampling for evidence (OCR + Qwen)
# Safe segments sample every 3s; suspicious every 5s by default.
# Adjust to control cadence and cost; capped by MAX_FRAMES_PER_SEG.
SEG_SAFE_SAMPLE_SEC=3.0
SEG_SUS_SAMPLE_SEC=5.0
MAX_FRAMES_PER_SEG=10

# Suspicion & Planner
# SAFE vs SUS via SUSPICION_MODE
# - off: all segments are SAFE.
# - keywords: SUS if the segment transcript contains built‑in risky keywords; else SAFE.
# - llm: SUS if the LLM returns suspicious:true OR confidence >= SUSPICION_LLM_CONF_THRESHOLD;
#        too‑short text (< SUSPICION_LLM_MIN_TEXT_CHARS) is treated SAFE; LLM errors/budget fall back to keywords.
# Sampling cadence: SAFE → SEG_SAFE_SAMPLE_SEC, SUS → SEG_SUS_SAMPLE_SEC.
ANALYSIS_PLANNING_MODE=segmentation        # segmentation|llm|hybrid
SUSPICION_MODE=llm                         # keywords|llm|off
SUSPICION_LLM_MODEL=                       # Optional override; otherwise follows per‑video LLM
SUSPICION_LLM_TIMEOUT_SEC=8
SUSPICION_LLM_CONF_THRESHOLD=0.6
SUSPICION_LLM_MAX_SEGMENTS=50
SUSPICION_LLM_MIN_TEXT_CHARS=80
SUSPICION_LLM_CACHE_TTL_SEC=86400
PLANNER_LLM_MAX_POINTS=5
PLANNER_MIN_GAP_SEC=8.0
PLANNER_MAX_EXTRA_FRAMES=120

# ===== Audio/Video Processing =====
FFMPEG_BINARY=ffmpeg

# ===== GPU Guard (cross-loop safe) =====
# Process-wide semaphore throttling for GPU-heavy sections across threads/loops.
# 0 disables guard; 1 serializes GPU work; >1 allows limited parallelism.
GPU_MAX_CONCURRENT=1

# ===== Observability =====
OBS_METRICS=true                           # Enable structured metrics logs

# Logging (app + uvicorn + SQLAlchemy)
LOG_LEVEL=INFO                             # DEBUG|INFO|WARNING|ERROR|CRITICAL
LOG_UVICORN_LEVEL=INFO                     # Uvicorn access/error log level
LOG_SQLALCHEMY_LEVEL=WARNING               # SQL query logging level

# ===== Misc =====
MAX_FILE_SIZE=524288000                    # 500MB in bytes (upload validation)

# ===== CORS (optional; disabled by default) =====
CORS_ENABLED=false                         # true/false (default: false)
CORS_ALLOW_ORIGINS=                        # Comma-separated list, e.g. https://app.example.com,https://admin.example.com
FRONTEND_ORIGINS=                          # Optional fallback for origins
CORS_ALLOW_CREDENTIALS=true                # true/false
CORS_ALLOW_METHODS=*                       # Comma-separated list or *
CORS_ALLOW_HEADERS=*                       # Comma-separated list or *
